function debug(e){if(arguments.length>1){console.log(arguments)}else{console.log(e)}}function __isNumeric(e){if(e===L){return q}if(e===undefined){return q}if(e==""){return q}e=e.toString().replace(/,/g,g);if(isNaN(e)==P){return q}else{return P}}function __toNumber(e){if(typeof e==D){e=this.valueOf()}if(e==undefined){return q}e=e.toString().replace(/,/g,g);if(__isNumeric(e)){if(e.match(/\./)){return parseFloat(e)}else{return parseInt(e)}}return 0}function __toArray(e){if(___isArray(e)){return e}return this.valueOf().toString().trim().split(/,/g)}var p="auto",T="[object Object]",X="filters",Y="data-opie-",K=100,g=".",L=null,P=true,q=false,D="undefined",m="object";var ___isArray=function(e){if(typeof e===m){if(typeof e.length==D){return q}return P}return q},__applyToAll=function(e,t){Array.prototype[e]=t;String.prototype[e]=t;Number.prototype[e]=t;Date.prototype[e]=t;Function.prototype[e]=t;RegExp.prototype[e]=t;Boolean.prototype[e]=t},__applyTo=function(e,t,n){if(e.match(/,/i)){ex=e.split(/,/i);for(i=0;i<ex.length;i++){__apply(ex[i],t,n)}}else{__apply(e,t,n)}},__apply=function(e,t,n){if(e=="Array"){Array.prototype[t]=n}else if(e=="String"){String.prototype[t]=n}else if(e=="Number"){Number.prototype[t]=n}else if(e=="Date"){Date.prototype[t]=n}else if(e=="Function"){Function.prototype[t]=n}else if(e=="RegExp"){RegExp.prototype[t]=n}else if(e=="Boolean"){Boolean.prototype[t]=n}};__apply("Array","isIn",function(e){if(!___isArray(e)){var t=e.toString().split(/,/g)}else{var t=e}arr=this.valueOf();for(var n=0;n<arr.length;n++){arrValue=arr[n];for(var r=0;r<t.length;r++){exValue=t[r];if(exValue==arrValue){return true}}}return false});__applyToAll("toNumber",__toNumber);var __toNegative=function(){var e=__toNumber(this.valueOf());if(e<=0){return e}return e*-1};__applyToAll("toNegative",__toNegative);if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}if(!Array.prototype.compare){Array.prototype.compare=function(e){if(!e)return false;if(this.length!=e.length)return false;for(var t=0;t<this.length;t++){if(this[t]instanceof Array&&e[t]instanceof Array){if(!this[t].compare(e[t]))return false}else if(this[t]!=e[t]){return false}}return true}}var __toPositive=function(){var e=__toNumber(this.valueOf());if(e<=0){e=e*-1}return e};__applyToAll("toPositive",__toPositive);__applyToAll("toArray",__toArray);var __toJSON=function(e){var t=typeof e;if(t!=m||e===L){if(t=="string")e='"'+e+'"';return String(e)}else{var n,r,i=[],s=e&&e.constructor==Array;for(n in e){r=e[n];t=typeof r;if(t=="string")r='"'+r+'"';else if(t==m&&r!==L)r=__toJSON(r);i.push((s?"":'"'+n+'":')+String(r))}return(s?"[":"{")+String(i)+(s?"]":"}")}};String.prototype.toJSON=__toJSON;var __toBool=function(){var e=this.valueOf();if(e==="1"||e===1||e==="true"||e==P){return P}return q};__applyToAll("toBool",__toBool);var __mathString=function(e){if(!this.valueOf().toNumber){console.trace()}var t=this.valueOf().toNumber();e=e.replace(" ","");$op=e.substring(0,1);mathValue=__toNumber(e.substring(1));newValue=mathValue;if($op=="+"){newValue=t+mathValue}else if($op=="*"){newValue=t*mathValue}else if($op=="-"){newValue=t-mathValue}else if($op=="%"){newValue=t*mathValue/K}else if($op=="/"||$op==":"){newValue=t/mathValue}return newValue};__applyTo("String,Number","math",__mathString);Function.prototype.eBind=function(e,t,n){var r=this;return function(){var i=t||arguments;if(n===P){i=Array.prototype.slice.call(arguments,0);i=i.concat(t)}else if(typeof n==="number"&&isFinite(n)){i=Array.prototype.slice.call(arguments,0);var s=[n,0].concat(t);Array.prototype.splice.apply(i,s)}return r.apply(e||window,i)}};Function.prototype.delay=function(e,t,n){var r=this,n=n||[],i=r.eBind(t,n);window.setTimeout(i,e);return r};String.prototype.toCamelCase=function(){return this.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()}).replace("-","")};Array.prototype.remove=function(e,t){var n=this.slice((t||e)+1||this.length);this.length=e<0?this.length+e:e;return this.push.apply(this,n)};__toFloat=function(){return parseFloat(this.valueOf())};__applyToAll("toFloat",__toFloat);__toInt=function(){return parseInt(this.valueOf())};__applyToAll("toInt",__toInt);$.support.transition=function(){var e=document.body||document.documentElement,t=e.style,n=t.transition!==undefined||t.WebkitTransition!==undefined||t.MozTransition!==undefined||t.MsTransition!==undefined||t.OTransition!==undefined;return n}();jQuery.fn.setData=function(e,t){if(String(e)==="[object Object]"&&typeof t=="undefined"){for(var n in e){jQuery(this).data("opie-"+n,e[n])}return this}else{return jQuery(this).data("opie-"+e,t)}};jQuery.fn.getData=function(e){return jQuery(this).data("opie-"+e)};jQuery.fn.setAttr=function(e,t){return jQuery(this).attr(Y+e,t)};jQuery.fn.getAttr=function(e){return jQuery(this).attr(Y+e)};jQuery.fn.delAttr=function(e){return jQuery(this).removeAttr(Y+e)};jQuery.fn.hasFilter=function(e){if(e===q||typeof e==D){return P}var t=jQuery(this).getData(X);if(typeof t[e]!=D){return P}return q};jQuery.fn.parseFilters=function(e){var t=jQuery(this),n=e?[]:{};if(t.getAttr("filter")){var r=t.getAttr("filter").toString().split(",");if(r.length>0){jQuery.each(r,function(t,r){if(e){n.push(r)}else{n[r]=true}})}}jQuery(this).setData("filters",n);return t};jQuery.fn.replaceClass=function(e,t){if(typeof t==D){if(e.toString().indexOf("|")>=0){ex=e.split("|");e=ex[0];t=ex[1]}else{t=e}}return this.removeClass(e).addClass(t)};jQuery.fn.ok=function(){return this.size()>0?P:q};jQuery.fn.getID=function(){return this.attr("id")};jQuery.fn.ID=function(e){if(typeof e!=D){return this.attr("id",e)}return this.attr("id")};jQuery.fn.reverse=[].reverse;var Is=new function(){this.object=function(e){return String(e)===T};this.defined=function(e){return typeof e!==D};this.array=function(e){if(typeof e==="object"){if(typeof e.length=="undefined"){return false}return true}return false};this.number=function(e){return typeof e==="number"&&isFinite(e)};this.string=function(e){return typeof e==="string"};this.func=function(e){return typeof e=="function"};this.cssSelector=function(e){if(Is.string(e)){if(e=="#"){return q}if(e.substr(0,1)=="#"||e.substr(0,1)==g){return P}}return q};this.between=function(e,t,n,r){var i=function(e,t,n){if(e>=t&&e<=n){return P}return q};if($.isArray(e)){var s=q;if(r=="and"){$.each(e,function(e,r){if(!i(r,t,n)){s=q;return q}})}else{$.each(e,function(e,r){if(i(r,t,n)){s=P;return q}})}return s}else{return i(e,t,n)}return q}},Utils=new function(){this.clone=function(e){if(e==L||!Is.object(e)){return e}var t={};for(var n in e){if(e.hasOwnProperty(n)){t[n]=Utils.clone(e[n])}}return t};this.defaultValue=function(e,t){t=!Is.defined(t)?q:t;if(!Is.defined(e)){return t}return e};this.roundNumber=function(e,t){var n=Math.round(e*Math.pow(10,t))/Math.pow(10,t);return n};this.calcNewImageSize=function(e,t,n,r,i){finalHeight=r;finalWidth=n;if(!Is.defined(i)){var i=q;if(e>t){i="W"}else if(e<t){i="H"}else{i="H"}if(n==p){i="H"}if(r==p){i="W"}}if(i=="H"){n=Utils.roundNumber(r*(e/t),0);r=finalHeight}else if(i=="W"){r=Utils.roundNumber(n*(t/e),0);n=finalWidth}return{ratio:i,h:r,w:n}}},Opts=function(e,t){this.opts=e;this.jq=t};Opts.prototype={get:function(e){return this.parse(this.opts[e])},string:function(e){return this.parse(this.opts[e],P)},number:function(e){return parseFloat(this.get(e))},bool:function(e){var t=this.get(e);if(t=="1"||t===P){return P}return q},selector:function(e){return this.jq(this.get(e))},func:function(e){return this.parse(this.opts[e],P,P)},parse:function(e,t,n){if(typeof e==D){return""}var r=e.valueOf();if(typeof r=="function"){if(n==P){return r}return r()}else if(Is.cssSelector(r)&&t!==P){var i=this.jq(r);if(i.size()<=0){debug("Opts.parse "+r+" not found");return falese}var s=i.get(0).tagName=="INPUT"&&i.attr("type").toString().toLowerCase()=="checkbox";if(s){return i.is(":checked")}return i.val()}else{return r}}};(function(e){"use strict";e.fn.OpiePortfolioGallery=function(t,n){var r={boxSelector:".o-box",innerWrapperSelector:".o-inner-wrapper",bigImageSelector:"img.o-big-image",thumbImageSelector:"img.o-thumb-image",extraInfoSelector:".o-extra-info",enlargeButtonSelector:".o-enlarge",maxBoxSize:195,loaderFadeInDuration:150,loaderFadeOutDuration:450,boxMovementDuration:300,delayIncrease:0,delayStart:0,maxDelay:0,scrollingAid:true,boxPositionEasing:"linear",extraInfoOpenEasing:"linear",extraInfoCloseEasing:"linear",boxOpenEasing:"linear",boxCloseEasing:"linear",boxOpenDuration:300,boxCloseDuration:300,filterNavSelector:false,dontResizeThumbs:false,useCentering:false,userCSS3Accelerate:true,showMore:12};var i=new Opts(e.extend(r,t),e);var s;this.each(function(){s=new e.OpiePortfolioGallery(i,e(this),arguments);if(t==="initCSS3"){IS.initCSS3.apply(s,n)}else{s.init()}});return this};e.OpiePortfolioGallery=function(t,n,r){var i=this;var s=n.find(t.string("boxSelector"));var o=n.find(t.string("innerWrapperSelector"));var u=t.number("maxBoxSize");var a=0;var f=0;var l=0;var c=false;var h=0;var p=t.bool("userCSS3Accelerate");var d=t.number("boxCloseDuration");var v=t.get("boxCloseEasing");var m=t.number("boxMovementDuration");var g=t.get("boxPositionEasing");var y=t.number("delayIncrease");var b=t.get("boxOpenEasing");var w=t.get("boxOpenDuration");this.init=function(){this.initCSS3();if(t.string("filterNavSelector")!==false){var r=e(t.string("filterNavSelector"));var o=r.filter(".active");if(o.size()>0){c=o.getAttr("filter")}r.click(function(){r.removeClass("active");s.removeClass("doReduce doEnlarge");e(this).addClass("active");c=e(this).getAttr("filter");i.fillTiles(false,true)})}s.each(function(){var n=e(this);n.parseFilters();if(n.find(t.string("extraInfoSelector")).size()>0){var r=n.find(t.string("bigImageSelector"));if(r.parent().is("a")){r=r.parent()}else{}r.wrap('<div class="o-big-image-wrapper" />');n.find(".o-big-image-wrapper").append('<a href="#" class="o-enlarge closed"><span>Enlarge</span></a>')}n.setData("positionData",false);n.append('<div class="loader" />')});s.find(t.string("enlargeButtonSelector")).click(function(){var r=e(this);var s=e(this).parents(t.string("boxSelector"));if(n.hasClass("inMotion")){return false}if(s.hasClass("doEnlarge")){s.replaceClass("doEnlarge","doReduce");r.replaceClass("opened","closed")}else{r.replaceClass("closed","opened");s.replaceClass("doReduce","doEnlarge")}i.fillTiles(false,false);return false});s.click(function(t){var r=e(t.target);if(n.hasClass("inMotion")){return false}var o=e(this);if(o.hasClass("portrait")){window.targetWidth=2;window.targetHeight=3}else{window.targetWidth=4;window.targetHeight=2}if(o.hasClass("o-show-more")){i.showMore()}else{s.removeClass("doReduce doEnlarge");if(o.hasClass("active")){o.removeClass("active").addClass("preDeActive")}else{o.addClass("preactive")}i.loader(s.filter(".active").addClass("wasActive"),true);i.loader(o,true);i.fillTiles(true,false,true);if(!r.parent().is("a")){return false}}});i.initSizes();var u=function(){var e=0;return function(t,n){clearTimeout(e);e=setTimeout(t,n)}}();var a,f;var l=e(window).resize(function(){var e=l.width();var n=l.height();if(a!=e||f!=n){u(function(){s.removeClass("active doEnlarge doReduce");s.find(t.string("bigImageSelector")).css("width","").css("height","");i.initSizes()},300)}a=e;f=n})};this.initCSS3=function(){if(p&&e.support.transition){JsCss.init();var t="all "+m/1e3+"s cubic-bezier("+CSS3Easings[g]+")";JsCss.addRuleStyle(".opie-portfolio .o-box.moving",{"-webkit-transition":t,"-moz-transition":t,"-o-transition":t,"-ms-transition":t,transition:t});var t="all "+w/1e3+"s cubic-bezier("+CSS3Easings[b]+")";JsCss.addRuleStyle(".opie-portfolio .o-box.opening",{"-webkit-transition":t,"-moz-transition":t,"-o-transition":t,"-ms-transition":t,transition:t})}};this.initSizes=function(){s.setData("positionData",false);var e=n.outerWidth(true)-(n.outerWidth()-n.width());o.width(e);var r=e/u;var f=Utils.roundNumber(r,2).toString().replace(/,/g,".").split(".");var l=t.bool("dontResizeThumbs");if(l===false){if(Is.defined(f[1])&&f[1]<50){var c=Math.ceil(r)}else{var c=Math.floor(r)}}else{var c=f[0].toNumber()}var p=true;a=Math.floor(100/c/100*e);if(l===false){while(p){if(a>u){c++;a=100/c/100*e}else{p=false}}}if(a>u){a=u;var d=u*c;if(e>d&&t.bool("useCentering")===true){h=e-d;o.width(e-h)}}i.fillTiles(false,true)};this.loadThumbs=function(n){if(!Is.defined(n)){n=s.not(".o-hidden")}n.each(function(){var n=e(this);var r=e(this).find(t.string("thumbImageSelector"));var s=r.getAttr("src");var o=false;if(s){if(s=="auto"){o=true;s=n.find(t.string("bigImageSelector")).getAttr("src");r.addClass("auto")}r.unbind("load").load(function(){r.delAttr("src");if(o){if(this.naturalWidth>this.naturalHeight&&o){r.addClass("height");r.css("marginLeft",this.width/2*-1)}else{r.addClass("width");r.css("marginTop",this.height/2*-1)}}r.addClass("loaded");i.loader(n,false)}).attr("src",s)}n.hover(function(){e(this).replaceClass("mouseOut","mouseOn")},function(){e(this).replaceClass("mouseOn","mouseOut")})})};this.loader=function(n,r){if(r==true){n.find("div.loader").each(function(){e(this).stop().fadeIn(t.number("loaderFadeInDuration"))})}else{n.find("div.loader").each(function(){e(this).stop().stop().fadeOut(t.number("loaderFadeOutDuration"))})}};this.rePosImg=function(t,n,r,i){var s={};if(r>t){var o=Utils.calcNewImageSize(r,i,t-(n-i)*2,"auto");r=o.w;i=o.h;s.width=r;s.height=i}s.marginLeft=(t-r)/2;s.marginTop=(n-i)/2;e(this).css(s)};this.fillTiles=function(r,u,l){if(n.hasClass("inMotion")){return false}n.addClass("inMotion");f=0;var h=0;var E=0;var S=0;var x=o.innerWidth();var T=0;var N=0;var C=0;var k=0;var L=s.filter(".preactive,.doEnlarge,.doReduce").size();var A=t.number("maxDelay");if(A==0){A=999999999}var O=t.number("delayStart");var M=function(t,n){var r=true;t.addClass("moving");for(var s=0;s<t.length;s++){var o=e(t[s]);if(!o.hasFilter(c)){o.addClass("filterOut")}else{o.removeClass("filtered")}if(!o.hasClass("preactive")&&!o.hasClass("doEnlarge")&&!o.hasClass("doReduce")||o.hasClass("filterOut")){var l={width:a,height:a};var b={};if(o.hasClass("filterOut")||o.hasClass("filtered")||o.hasClass("o-hidden")){if(!o.hasClass("filtered")){if(r==true){l.left=a.toNegative();r=false}else{l.left=x+a;r=true}l.top=a.toNegative();o.addClass("filtered")}}else{l.left=E;l.top=h;var w=E+a;if(w>x){h+=a;E=0}w=E+a;W=h+a;if(L>0){var S=true;while(S){if(Is.between(E,T,N-1)&&Is.between(h,C,k-1)||Is.between(w-1,T,N-1)&&Is.between(W-1,C,k-1)){E=N;var w=E+a;if(w>x){h+=a;E=0;S=true}else{S=false}}else{S=false}}}var w=E+a;if(w>x){h+=a;E=0}l.left=E;l.top=h;E+=a;f=Math.max(f,h+a)}if(o.hasClass("preDeActive")||o.hasClass("active")){b.duration=d;b.easing=v}else{b.duration=m;b.easing=g}b.complete=function(){var t=e(this);if(t.hasClass("active")||t.hasClass("o-show-more")||t.hasClass("preDeActive")){i.loader(t,false)}t.removeClass("preDeActive active moving");if(t.hasClass("last")){i.afterLastAnimation()}};var M=o.getData("LastAnimCss");if(u==true){o.setData("positionData",{left:l.left,top:l.top})}if(o.hasClass("o-hidden")){o.css(l);b.complete.eBind(o)()}else{var _=true;if(M&&M.left==l.left&&M.top==l.top&&M.height==l.height&&M.width==l.width){_=false}if(_==true){if(p&&e.support.transition){o.css.eBind(o,[l]).delay(O);b.complete.eBind(o).delay(O+b.duration)}else{b.queue=false;o.delay(O).animate(l,b)}if(O<A){O+=y}}else{b.complete.eBind(o)()}}o.setData("LastAnimCss",l)}else{o.removeClass("activated moving")}}};s.removeClass("filterOut");var _=r?s.not(".filtered,.filterOut"):s;s.removeClass("last");_.last().addClass("last");var D=_.filter(".doEnlarge");if(D.size()>0){var P={};var H={duration:t.number("extraInfoOpenDuration")};D.setData("beforeEnlargeHeight",D.height());var B=D.outerWidth(true);var j=D.outerHeight(true)+D.find(t.string("extraInfoSelector")).outerHeight(true);var F=Math.ceil(j/a);j+=F*a-j;P.height=j;var I=D.position();P.left=I.left;P.top=I.top;T=P.left;N=T+B;C=P.top;k=C+j;f=Math.max(f,k);H.easing=t.get("extraInfoCloseEasing");D.delay(O).animate(P,H);if(O<A){O+=t.number("delayIncrease")}if(!D.hasFilter(c)){D.addClass("filterOut")}D.setData("LastAnimCss",P);D=false}var q=_.filter(".doReduce");if(q.size()>0){var P={};var H={duration:t.number("extraInfoCloseDuration")};var B=q.outerWidth(true);var j=q.getData("beforeEnlargeHeight");P.height=j;var I=q.position();P.left=I.left;P.top=I.top;T=P.left;N=T+B;C=P.top;k=C+j;f=Math.max(f,k);H.easing=t.get("extraInfoOpenEasing");q.animate(P,H);if(!q.hasFilter(c)){q.addClass("filterOut")}q.setData("LastAnimCss",P);q=false}var R=_.filter(".preactive");if(R.size()>0){R.addClass("opening");var P={};var H={duration:w};var B=a*targetWidth;var j=a*targetHeight;if(B>x){B=x}P.width=B;P.height=j;var U=R.getData("positionData");if(U!==false&&R.hasClass("last")&&R.prevAll(t.string("boxSelector")+".wasActive").size()>0||R.nextAll(t.string("boxSelector")+".wasActive").size()>0){P.left=U.left;P.top=U.top}else{var I=R.position();P.left=I.left;P.top=I.top}s.removeClass("wasActive");var z=P.left+B;var W=P.top+j;if(z>x){var X=x-B;P.left=X;if(P.left<0){P.left=0}}T=P.left;N=T+B;C=P.top;k=C+j;f=Math.max(f,k);if(t.bool("scrollingAid")){var V=e(window).scrollTop();var J=o.offset();var K=e(window).height()+V;var Q=J.top+k;if(Q>K){e("html, body").animate({scrollTop:"+="+(Q-K+j/2)},300)}var G=J.top+C;if(G<V){e("html, body").animate({scrollTop:G-j/2},300)}}H.complete=function(){var n=e(this);var r=n.find(t.string("bigImageSelector"));if(r.getAttr("src")){var s=r.getAttr("src");r.unbind("load").load(function(){r.setData("width",this.naturalWidth);r.setData("height",this.naturalHeight);i.rePosImg.call(r,B,j,this.naturalWidth,this.naturalHeight);n.replaceClass("preactive","active");r.delAttr("src");i.loader(n,false)}).attr("src",s)}else{i.rePosImg.call(r,B,j,r.getData("width"),r.getData("height"));n.replaceClass("preactive","active");i.loader(n,false)}n.removeClass("opening").find(t.string("enlargeButtonSelector")).removeClass("opened");if(n.hasClass("last")){i.afterLastAnimation()}};H.easing=b;if(p&&e.support.transition){R.css.eBind(R,[P]).delay(O);H.complete.eBind(R).delay(O+H.duration)}else{H.queue=false;R.delay(O).animate(P,H)}if(!R.hasFilter(c)){R.addClass("filterOut")}if(O<A){O+=t.number("delayIncrease")}M(R.prevAll().reverse());O=0;M(R.nextAll(),true);R.setData("LastAnimCss",P);R=false}else{M(_)}i.fixPortSize(false)};this.showMore=function(){var e=t.number("showMore");if(!e){e=1}var n=s.filter(".o-hidden").slice(0,e).removeClass("o-hidden");i.fillTiles(false,true)};this.afterLastAnimation=function(){n.removeClass("inMotion");window.setTimeout(i.loadThumbs,100);i.fixPortSize(true);if(s.filter(".o-hidden").size()<=0){s.filter(".o-show-more").hide()}};this.fixPortSize=function(e){var t=o.position().top+o.innerHeight();if(f>t){var n="+="+(f-t)}else{var n="-="+(t-f)}if(e==false&&l>f){return false}o.stop().animate({height:n},"fast");l=f}}})(jQuery)